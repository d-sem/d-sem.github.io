<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<p id ='token'></p>
<hr>
<p id="demo"></p>
<button id="reg">
 reg
</button>
<button id="auth">
    auth
</button>

<button id="out">
    out
</button>

<hr>
<button id="get-users">
  get users
</button>

<button id="get-messages">
  get users
</button>
<hr>

<script src="functions.js">

</script>
<script>
    var URL = 'http://cryptic-taiga-39170.herokuapp.com';

    token.echo();

    document.getElementById('reg').addEventListener('click', function (){
       console.log('click');

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4) {
                if (this.status == 422){
                    echo('имя занято');
                }
                if (this.status == 201) {
                    echo('пользователь зарегистрирован');
                }
            }
        };
        xhr.open('POST', URL + '/users/', true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send("name=testman1&email=mail1@mail.com&password=123123&password_confirmation=123123");

    });



    document.getElementById('auth').addEventListener('click', function (){
        console.log('click');

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var response = this.responseText;
                console.dir(response);
                response = JSON.parse(response);
                console.dir(response);
                console.log(response.auth_token);
                localStorage.setItem('token', response.auth_token);
                document.getElementById("token").innerHTML = response.auth_token;
                echo(response);
            }
        };


        xhr.open("POST", URL + "/authenticate/", true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send("email=mail@mail.com&password=123123");
    });

    document.getElementById('auth').addEventListener('click', function (){
        console.log('click');

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                echo(this.responseText);
            }
        };
        xhr.open("POST",  URL + "/authenticate/", true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send("email=mail@mail.com&password=123123");
    });

    document.getElementById('get-users').addEventListener('click', function (){
        console.log('click');

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                echo(this.responseText);
            }
        };
        xhttp.open("GET", URL + "/users/", true);
        xhttp.setRequestHeader("Authorization", token.get());
        xhttp.send();
    });

    document.getElementById('get-messages').addEventListener('click', function (){
        console.log('click');

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                echo(this.responseText);
            }
        };
        xhttp.open("GET", URL + "/messages/", true);
        xhttp.setRequestHeader("Authorization", token.get());
        xhttp.send();
    });

    document.getElementById('post-message').addEventListener('click', function (){
        console.log('click');

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                echo(this.responseText);
            }
        };
        xhr.open("POST",  URL + "/authenticate/", true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send("email=mail@mail.com&password=123123");
    });
</script>

</body>
</html>